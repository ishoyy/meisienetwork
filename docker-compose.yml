services:
  meisie:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        # Baked into the Next.js client bundle at build time
        NEXT_PUBLIC_BASE_URL: ${NEXT_PUBLIC_BASE_URL:-http://localhost:3000}
    ports:
      - "3000:3000"
    environment:
      # Runtime-only secrets — never baked into the image
      NODE_ENV: production
      NEXT_TELEMETRY_DISABLED: 1

      # Database — mapped to the volume below
      DB_PATH: /app/data/sqlite.db

      # Resend email service
      RESEND_API_KEY: ${RESEND_API_KEY}
      RESEND_FROM_EMAIL: ${RESEND_FROM_EMAIL}

      # Base URL (also needed server-side for reset-password links)
      NEXT_PUBLIC_BASE_URL: ${NEXT_PUBLIC_BASE_URL:-http://localhost:3000}
    volumes:
      # Persist the SQLite database across container restarts
      - meisie_data:/app/data
    restart: unless-stopped

volumes:
  meisie_data:
